<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHUNO - Iniciar Sesión</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

    <!-- Incluye el SDK de Firebase desde la CDN oficial -->
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-analytics.js"></script>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">
                <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo Conferencia Chuno">
            </div>
            <h1>Conferencias Chuno</h1>
            <nav>
                <ul class="nav-list">
                    <li><a href="{{ url_for('index') }}" class="active">Inicio</a></li>
                    <li><a href="{{ url_for('sobre_nosotros') }}">Sobre Nosotros</a></li>
                    <li><a href="{{ url_for('programa') }}">Programa de Conferencias</a></li>
                    <li><a href="{{ url_for('salas') }}">Salas</a></li>
                    <li><a href="{{ url_for('diapositivas') }}">Diapositivas de Oradores</a></li>
                    <li><a href="{{ url_for('votacion') }}">Votación</a></li>
                    <li><a href="{{ url_for('inicio_sesion') }}">Iniciar Sesión</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="login-container">
            <div class="login-box">
                <h2>Iniciar Sesión</h2>
                <form id="login-form">
                    <div class="input-group">
                        <label for="email">Correo Electrónico:</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="input-group">
                        <label for="password">Contraseña:</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    <button type="submit" class="btn-login">Entrar</button>
                    <p>¿No tienes una cuenta? <a href="{{ url_for('autenticacion_bp.signup') }}">Regístrate aquí</a></p>
                </form>                
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-section">
                <h1>Contáctanos</h1>
                <p>Email: <a href="mailto:ChunoEventos@gmail.com">ChunoEventos@gmail.com</a></p>
                <p>Teléfono: <a href="tel:+65161616">66151512101</a></p>
                <p>Dirección: Universidad Católica Boliviana, La Paz, Bolivia</p>
            </div>
            
            <div class="footer-section">
                <h3>Síguenos en nuestras redes</h3>
                <ul class="social-media">
                    <li><a href="#"><img src="{{ url_for('static', filename='img/facebook.png') }}" alt="Facebook" class="social-icon"></a></li>
                    <li><a href="#"><img src="{{ url_for('static', filename='img/instagram.png') }}" alt="Instagram" class="social-icon"></a></li>
                    <li><a href="{{ url_for('static', filename='img/whatsapp.png') }}" alt="WhatsApp" class="social-icon"></a></li>
                </ul>
            </div>
        </div>
        <div class="bottom-bar">
            <p>&copy; 2024 Conferencia Chuno - Todos los derechos reservados.</p>
        </div>
    </footer>

    <!-- Inicialización de Firebase y manejo de inicio de sesión -->
    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCIeYBM8_pmHTB8M5WrKtiYs43STF-Sx2U",
            authDomain: "chuno-6384b.firebaseapp.com",
            databaseURL: "https://chuno-6384b-default-rtdb.firebaseio.com",
            projectId: "chuno-6384b",
            storageBucket: "chuno-6384b.appspot.com",
            messagingSenderId: "961285732641",
            appId: "1:961285732641:web:041aafd7d44b7c0051e660",
            measurementId: "G-W41SD9B2W8"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        console.log("Firebase ha sido inicializado correctamente.");

        // Manejo del inicio de sesión
        document.getElementById("login-form").addEventListener("submit", function(event) {
            event.preventDefault();
            console.log("Formulario de inicio de sesión enviado.");

            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            console.log("Email:", email);
            console.log("Password:", password);

            firebase.auth().signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    console.log("Autenticación exitosa.");
                    const user = userCredential.user;
                    console.log("Usuario autenticado:", user);

                    // Aquí puedes redirigir al backend Flask
                    fetch('/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            uid: user.uid,
                            email: user.email,
                            displayName: user.displayName
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log("Respuesta del backend:", data);
                        if (data.success) {
                            window.location.href = "/";
                        } else {
                            console.error("Error al iniciar sesión en el backend:", data.message);
                        }
                    });
                })
                .catch((error) => {
                    console.error("Error de autenticación en Firebase:", error.message);
                });
        });
    </script>
</body>
</html>
